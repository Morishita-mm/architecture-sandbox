project_info:
  name: Architecture Sandbox Backend
  description: システムアーキテクチャ設計支援ツールのバックエンドサーバー
  last_updated: 2025-12-11
  status: Deployment Completed (Social Features Added)

current_status:
  deployment:
    backend:
      platform: AWS App Runner
      source: AWS ECR (Container Registry)
      image_tag: architecture-sandbox-backend:latest
      scaling: Auto-scaling (Managed by App Runner)
    frontend:
      platform: AWS S3 + CloudFront (CDN)
      type: Static Site / SPA Hosting
  architecture:
    type: Stateless REST API
    database: None (Mock implementation)
    concurrency: Supported (Async/Non-blocking via Tokio)

infrastructure:
  docker:
    file: backend/Dockerfile.prod
    base_image_builder: rust:latest
    base_image_runner: debian:bookworm
    build_context: Project Root (.)
    key_configurations:
      - Copying 'frontend/src/constants/architecture_defs.json' to container
      - Setting ENV 'ARCH_DEFS_PATH'
  environment_variables:
    GEMINI_API_KEY: Required (Google Gemini API access)
    ARCH_DEFS_PATH: Optional (Default: /app/architecture_defs.json in prod)

backend_implementation:
  tech_stack:
    language: Rust
    web_framework: Axum
    async_runtime: Tokio
    http_client: Reqwest
    serialization: Serde / Serde JSON

  api_endpoints:
    POST /api/evaluate:
      description: ユーザーが作成したアーキテクチャ図をAIが評価する
      logic:
        - Load 'architecture_defs.json' (Dynamic file read)
        - Inject custom scenario constraints (difficulty based specs)
        - Build system prompt from 'system_prompt.txt'
        - Call Gemini 2.5 Flash API
      response: Evaluation score and feedback

    POST /api/chat:
      description: 顧客（AI）とのチャット機能
      logic:
        - Determine persona (CEO, CTO, CFO) based on request
        - Inject hidden context/requirements based on 'scenario_id'
        - Call Gemini 2.5 Flash API with chat history
      response: AI character response

    POST /api/shorten:
      description: 共有URL短縮機能 (New!)
      logic:
        - Receive long URL (with Base64 scenario data)
        - Call TinyURL API (External)
        - Return shortened URL
      response: JSON { "short_url": "https://tinyurl.com/..." }

    POST /api/projects:
      description: プロジェクト保存（ダミー）
      status: Mock (No persistence)
      response: Success status with input ID

  external_services:
    ai_model:
      provider: Google Gemini API
      model: gemini-2.5-flash
      features: generateContent
    url_shortener:
      provider: TinyURL API
      features: create-api

recent_changes:
  - id: feat_url_shortener
    description: 共有機能のためにTinyURL APIを利用したURL短縮エンドポイントを実装
  - id: feat_rich_ui_help
    description: フロントエンドUI刷新（リッチフォント、ヘッダー分離、ヘルプモーダル実装）
  - id: fix_evaluation_logic
    description: 評価APIへユーザー入力値（Label/Description）をパススルーするよう修正し、AI評価精度を向上
  - id: deploy_infrastructure
    description: AWS App Runner (Backend) と S3+CloudFront (Frontend) へのデプロイ完了

known_issues_and_limitations:
  persistence:
    status: Local Only
    detail: サーバーサイドでの永続化は廃止。クライアントサイドのJSON保存・読込で代替中。
  security:
    cors: Allow Any (Development/Initial Phase)